<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Morph Debug Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #111; color: #fff; }
        
        /* Header */
        .header { 
            position: fixed; top: 0; left: 0; width: 100%; height: 40px; 
            background: #2d2e34; z-index: 100; 
            display: flex; align-items: center; justify-content: center;
        }
        
        /* Hero */
        .hero { 
            position: relative; width: 100%; height: 758px; 
            background: #000; margin-top: 40px; 
        }
        .hero-overlay { 
            position: absolute; inset: 0; 
            background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0.2)); 
        }
        
        /* Red Nav */
        .red-nav {
            position: absolute; left: 50%; bottom: 0; transform: translateX(-50%);
            width: 85%; height: 80px; background: #c8091e;
            border-radius: 60px 60px 0 0; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 20; transition: all 0.6s ease;
            display: flex; align-items: center; justify-content: center;
        }
        .red-nav.morph {
            position: fixed; top: 40px; border-radius: 0 0 60px 60px; z-index: 25;
        }
        
        /* Content */
        .content { 
            height: 1200px; background: linear-gradient(#111, #222, #333); 
            display: flex; align-items: center; justify-content: center; 
            font-size: 2rem; color: #bbb; 
        }
        
        /* Debug Panel */
        .debug {
            position: fixed; top: 50px; right: 10px; background: rgba(0,0,0,0.8);
            padding: 10px; border-radius: 5px; font-size: 12px; z-index: 200;
            min-width: 200px;
        }
        .debug div { margin: 2px 0; }
        .status { color: #0f0; }
        .error { color: #f00; }
    </style>
</head>
<body>
    <div class="header">HEADER (40px)</div>
    
    <div class="hero" id="hero">
        <div class="hero-overlay"></div>
        <div class="red-nav" id="redNav">RED NAV</div>
    </div>
    
    <div class="content">Scroll to test morphing</div>
    
    <div class="debug" id="debug">
        <div><strong>Debug Panel</strong></div>
        <div id="scrollY">Scroll Y: 0</div>
        <div id="triggerY">Trigger Y: 0</div>
        <div id="heroTop">Hero Top: 0</div>
        <div id="heroHeight">Hero Height: 0</div>
        <div id="navHeight">Nav Height: 0</div>
        <div id="headerHeight">Header Height: 0</div>
        <div id="morphState">Morphed: false</div>
        <div id="status" class="status">Ready</div>
    </div>

    <script>
        const nav = document.getElementById('redNav');
        const hero = document.getElementById('hero');
        const header = document.querySelector('.header');
        const debug = document.getElementById('debug');
        
        const HYSTERESIS = 24;
        let triggerY = 0;
        let isMorphed = false;
        let ticking = false;

        function updateDebug() {
            const scrollY = window.pageYOffset || document.documentElement.scrollTop;
            document.getElementById('scrollY').textContent = `Scroll Y: ${scrollY}`;
            document.getElementById('triggerY').textContent = `Trigger Y: ${triggerY}`;
            document.getElementById('heroTop').textContent = `Hero Top: ${hero.offsetTop}`;
            document.getElementById('heroHeight').textContent = `Hero Height: ${hero.offsetHeight}`;
            document.getElementById('navHeight').textContent = `Nav Height: ${nav.offsetHeight}`;
            document.getElementById('headerHeight').textContent = `Header Height: ${header.offsetHeight}`;
            document.getElementById('morphState').textContent = `Morphed: ${isMorphed}`;
        }

        function computeTriggerY() {
            const heroTop = hero.offsetTop;
            triggerY = heroTop + hero.offsetHeight - nav.offsetHeight - header.offsetHeight;
            return triggerY;
        }

        function updateOnScroll() {
            const y = window.pageYOffset || document.documentElement.scrollTop;
            
            if (!isMorphed && y >= triggerY) {
                nav.classList.add('morph');
                isMorphed = true;
                document.getElementById('status').textContent = 'MORPHED!';
                document.getElementById('status').className = 'status';
            } else if (isMorphed && y <= triggerY - HYSTERESIS) {
                nav.classList.remove('morph');
                isMorphed = false;
                document.getElementById('status').textContent = 'NORMAL';
                document.getElementById('status').className = 'status';
            }
            
            updateDebug();
        }

        function onScroll() {
            if (!ticking) {
                requestAnimationFrame(() => {
                    updateOnScroll();
                    ticking = false;
                });
                ticking = true;
            }
        }

        function init() {
            computeTriggerY();
            updateOnScroll();
            document.getElementById('status').textContent = 'Initialized';
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        window.addEventListener('resize', init);
        window.addEventListener('load', init);
        
        // Initialize after a short delay
        setTimeout(init, 100);
    </script>
</body>
</html>